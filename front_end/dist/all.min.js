"use strict";function preloadComponents(){for(var e in loadHTMLModules)loadHTMLComponent(e,function(){})}function loadComponent(e,t,n){return void 0===loadHTMLModules[e]?void console.log("Invalid module"):void loadHTMLComponent(e,function(e){$(t).html(e),n()})}function loadComponentOrLogin(e,t,n){callAPI(login_origins.backend+"/isUserLoggedIn","GET",{},function(i){i.result===!0?loadComponent(e,t,n):window.location.href=window.location.origin+window.location.pathname+"/#/?redirectURL="+encodeURIComponent(window.location.href)})}function loadHTMLComponent(e,t){if(void 0!==window.appModules[e])return void t(window.appModules[e]);var n=loadHTMLModules[e];$.ajax({url:n,data:{},success:function(n){window.appModules[e]=n,t(n)},error:function(e,t,n){console.log("Something went wrong when loading "+fileName),console.log("Status: "+t+" Error: "+n)}})}function callAPI(e,t,n,i){$.ajax({url:e,data:n,type:t,xhrFields:{withCredentials:!0},success:function(e){i(e)},error:function(t,n,i){console.error("Something went wrong when loading "+e),console.error("Status: "+n+" Error: "+i)}})}function redirectToAuth(){window.location.port=3e3}function createCookie(e,t,n){var i="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),i="; expires="+o.toUTCString()}document.cookie=e+"="+t+i+"; path=/"}function readCookie(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function loadJavascriptDynamically(e,t){loadJSDynamicallyHelper(e,0,t)}function loadJSDynamicallyHelper(e,t,n){return t==e.length?void n():void $.getScript(e[t],function(i,o,s){"success"!=o&&console.error(e[t]+" failed to load"),loadJSDynamicallyHelper(e,t+1,n)})}function loadCSSDynamically(e){$("head").append("<link>");var t=$("head").children(":last");t.attr({rel:"stylesheet",type:"text/css",href:e})}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function myFunction(){var e,t,n,i,o,s,a,r;e=document.getElementById("searchBar1"),t=e.value.toUpperCase(),n=document.getElementById("myTable"),i=n.getElementsByTagName("tr");var l=0;for(r=0;r<i.length;r++)o=i[r].getElementsByTagName("td")[0],s=i[r].getElementsByTagName("td")[1],a=i[r].getElementsByTagName("td")[2],o&&s&&a&&(o.innerHTML.toUpperCase().indexOf(t)>-1||s.innerHTML.toUpperCase().indexOf(t)>-1||a.innerHTML.toUpperCase().indexOf(t)>-1?i[r].style.display="":(i[r].style.display="none",l++));l==i.length-1?$(".no-results-courses").addClass("no-results-show"):$(".no-results-courses").removeClass("no-results-show")}function sortTable(e){var t,n,i,o,s,a,r,l,d=0;for(t=document.getElementById("myTable"),i=!0,l="asc";i;){for(i=!1,n=t.getElementsByTagName("tr"),o=1;o<n.length-1;o++)if(r=!1,s=n[o].getElementsByTagName("td")[e],a=n[o+1].getElementsByTagName("td")[e],"asc"==l){if(s.innerHTML.toLowerCase()>a.innerHTML.toLowerCase()){r=!0;break}}else if("desc"==l&&s.innerHTML.toLowerCase()<a.innerHTML.toLowerCase()){r=!0;break}r?(n[o].parentNode.insertBefore(n[o+1],n[o]),i=!0,d++):0==d&&"asc"==l&&(l="desc",i=!0)}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function loadCSSBasedOnURLPath(e){loadCSSDynamically("https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"),loadCSSDynamically("https://fonts.googleapis.com/css?family=Roboto:300,400,700,900"),loadCSSDynamically("https://unpkg.com/purecss@0.6.2/build/pure-min.css"),loadCSSDynamically("http://vjs.zencdn.net/5.16.0/video-js.css"),loadCSSDynamically("styles/video_module/index.css")}function getUrlVars(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,n,i){e[n]=i});return e}function callAJAX(e,t,n,i){$.ajax({type:e,url:t,data:n,success:i,xhrFields:{withCredentials:!0},error:function(){console.error("ERROR")}})}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}window.appModules={};var loadHTMLModules={CommentModule:"comment_module.html",CourseHomepageModule:"course_homepage_module.html",CourseSearchModule:"course_search_module.html",SearchResultsModule:"search_videos_module.html",CourseVideosModule:"course_videos_module.html",LoaderModule:"loader_module.html",MenuModule:"menu_module.html",OnboardingCoursesModule:"onboarding_courses_module.html",OnboardingFrontPage:"onboarding_module.html",PodcastModule:"podcast_module.html",PostModule:"post_module.html",PostSearchModule:"post_search_module.html",VideoModule:"video_module.html",AudioOCRSubMod:"audio_ocr_search_sub_module.html",AudioOCRMod:"audio_ocr_search_module.html",SlideTransitionModule:"slide_transition_module.html",RecommendationsModule:"recommendations_module.html",NotesModule:"notes_module.html"};preloadComponents(),$.expr[":"].contains=$.expr.createPseudo(function(e){return function(t){return $(t).text().toUpperCase().indexOf(e.toUpperCase())>=0}});var login_origins={backend:"http://104.131.147.159:3000"},_require={baseUrl:"javascript/",shim:{bootstrap:{deps:["jquery","local_tether"]},tether:{deps:["jquery"],exports:"tether"},local_tether:{deps:["jquery"]},jquery:{exports:"$"},moment:{deps:["jquery"]},markjs:{deps:["jquery"]},alertbox:{deps:["jquery"]},components:{deps:["jquery","config"]},postLoad:{deps:["alertbox","markjs","local_tether","moment","components"]},postSearch:{deps:["postLoad","ocr_module","BoyerMoore","jquery","jquery-ui","navbar","notes","post-dropdown"]},notes:{deps:["jquery"]},videojs:{deps:["jquery"]},podcast:{deps:["postSearch","video-wrapper"]},"video-wrapper":{deps:["videojs","video_hotkeys"]},video_hotkeys:{deps:["videojs","local_tether"]},director:{deps:["jquery","angular"]},loader:{},angular:{},"post-dropdown":{},navbar:{deps:["bootstrap","jquery","jquery-ui"]},"course-videos":{deps:["jquery","bootstrap","moment"]},"search-videos":{deps:["jquery","bootstrap"]},"course-homepage":{deps:["course-videos","components"]},"course-selection":{deps:["bootstrap","jquery","jquery-ui","config"]},searchResults:{deps:["angular","postSearch","navbar","bootstrap","search-videos"]},ocr_module:{deps:["jquery","ocr_txt_mod"]},ocr_txt_mod:{deps:["jquery"]}},paths:{jquery:"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min","jquery-ui":"https://code.jquery.com/ui/1.12.1/jquery-ui",tether:"https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min",local_tether:"bootstrap_js/tether",bootstrap:"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min",moment:"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min",alertbox:"https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min",markjs:"https://cdn.jsdelivr.net/mark.js/8.8.3/mark",postLoad:"post_module/postLoad",postSearch:"post_module/postSearch",BoyerMoore:"post_module/BoyerMoore",notes:"notes_module/notes",components:"components",director:"https://rawgit.com/flatiron/director/master/build/director.min",angular:"https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min",videojs:"http://vjs.zencdn.net/5.16.0/video",video_hotkeys:"https://cdn.sc.gl/videojs-hotkeys/0.2/videojs.hotkeys.min",podcast:"podcast_module/podcast","video-wrapper":"video_module/video",loader:"loader_module/jsloader",navbar:"menu_module/NavBarLoggedIn","course-videos":"course_videos_module/course_videos","course-homepage":"course_homepage_module/course_homepage","course-selection":"onboarding_module/onboarding_courses",onboarding:"onboarding_module/onboarding",config:"config",searchResults:"search_module/searchResults","search-videos":"search_module/search-videos",ocr_module:"post_module/ocr_audio_parse",ocr_txt_mod:"post_module/text_ocr_audio_parse","post-dropdown":"post_module/PodcastDropdownMenu","search-results":"search_module/search-results",recommendations:"recommendations_module/recommendations"}},query_str=window.location.search.substring(1),queries=query_str.split("&").map(function(e){var t=e.split("="),n=t[0],i=t[1],o={};return o[n]=i,o}).reduce(function(e,t){var n=Object.keys(t)[0];return e[n]=t[n],e},{});if(queries.hasOwnProperty("id")){var id=queries.id;readCookie("fb_id")||createCookie("fb_id",id,7),window.location.href="/onboarding_courses_module.html"}else redirectToAuth();define(["tether","moment","videojs"],function(e,t,n){return window.Tether=e,window.moment=t,window.videojs=n,e});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),CourseHomepageClass=function(){function e(t,n,i){_classCallCheck(this,e),this.courseId=t,this.mainDiv=n,this.loadingCallback=i,this.loadNavbar(this),this.loadCourseVideos(this),this.loadPostSearch(this)}return _createClass(e,[{key:"loadNavbar",value:function(e){require(["navbar"],function(){var t=$(e.mainDiv).find("#navbox");loadComponent("MenuModule",t,function(){new NavBarLoggedInCourse(t,e.courseId)})})}},{key:"dynamicWindowResize",value:function(e){$(window).on("resize",function(){0==$(e.mainDiv).length?$("#myimage").off("click.mynamespace"):e.updateComponentHeights()}),$(e.mainDiv).bind("DOMSubtreeModified",function(){e.updateComponentHeights()})}},{key:"updateComponentHeights",value:function(){var e=$(window).height()-$(this.mainDiv).find("#navbox").height();$(this.mainDiv).find("#course-posts").css("height",e-35),$(this.mainDiv).find("#course-videos").css("height",e-35)}},{key:"loadPostSearch",value:function(e){require(["postSearch"],function(){var t=$(e.mainDiv).find("#course-posts");loadComponent("PostSearchModule",t,function(){new PostSearch({UniqueID:e.courseId,TypeOfFetch:"CourseGlobal"},{Name:e.UserName,Pic:e.Pic},t),e.dynamicWindowResize(e)})})}},{key:"loadCourseVideos",value:function(e){require(["course-videos"],function(){var t=$(e.mainDiv).find("#course-videos");loadComponent("CourseVideosModule",t,function(){new CourseVideosClass(e.courseId,$(e.mainDiv),e.loadingCallback)})})}}]),e}(),CourseVideosClass=function e(t,n,i){_classCallCheck(this,e),this.courseId=t,this.mainDiv=n,this.loadingCallback=i,callAPI(login_origins.backend+"/getVideosForCourse","GET",{CourseId:t},function(e){var t=document.getElementById("course-videos-div"),n=document.createElement("div");n.className="row videos-row",t.appendChild(n);for(var i=e.Videos,o=0;o<i.length;o++){var s=i[o];3==n.childElementCount&&(n=document.createElement("div"),n.className="row videos-row",t.appendChild(n));var a=document.createElement("div");a.className="col-4",n.appendChild(a);var r=document.createElement("img");r.className="course-videos-preview-images",r.src=s.PreviewImage,r.addEventListener("click",function(){window.location.hash="#/podcast/"+this.Id}.bind(s)),a.appendChild(r);var l=document.createElement("p");l.align="center",l.innerHTML=moment(s.Time).format("ddd, M/D"),l.className="text-title",a.appendChild(l)}this.loadingCallback()}.bind(this))},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),autokeys=[],NavBarLoggedInCourse=function(){function e(t,n){_classCallCheck(this,e),this.mainDiv=t,this.classID=n;var i=this;this.fetchUserData(function(e,t){i.setUserName(e),i.setProfPic(t)}),this.fetchCourseData(n,function(e,t){i.setClassName(e),i.setClassQuarter(t),i.setPlaceHolder(e,t)}),this.setHomeHyperLink()}return _createClass(e,[{key:"fetchCourseData",value:function(e,t){callAPI(login_origins.backend+"/getCourseInfo","GET",{CourseId:e},function(e){var n=e.Quarter;n.indexOf("fa")>-1&&(n="Fall "+n.slice(-2)),n.indexOf("wi")>-1&&(n="Winter "+n.slice(-2)),n.indexOf("sp")>-1&&(n="Spring "+n.slice(-2)),n.indexOf("s2")>-1&&(n="SS2 "+n.slice(-2)),n.indexOf("s1")>-1&&(n="SS1 "+n.slice(-2)),t(e.Course,n),this.classID=e.Id,this.setCoursesHyperLink(e.Id),this.listenToUserSearch(),this.initAutocomplete(e.Id)}.bind(this))}},{key:"listenToUserSearch",value:function(){$(this.mainDiv).find(".main_search_container").on("submit",function(e){e.preventDefault(),0!=$(this.mainDiv).find("#searchBar").val().trim().length&&(window.location.hash="#/search/"+this.classID+"/"+encodeURIComponent($(this.mainDiv).find("#searchBar").val()))}.bind(this))}},{key:"fetchUserData",value:function(e){callAPI(login_origins.backend+"/getUser","GET",{},function(t){e(t.Name,t.Pic),this.initLogout(t.Name)}.bind(this))}},{key:"setClassName",value:function(e){$(this.mainDiv).find("#className").html(e)}},{key:"setClassQuarter",value:function(e){$(this.mainDiv).find("#classQuarter").html(e)}},{key:"setPlaceHolder",value:function(e,t){$(this.mainDiv).find("#searchBar").attr("placeholder","Search in "+e+" "+t)}},{key:"setValueOfSearchBar",value:function(e){$(this.mainDiv).find("#searchBar").val(e)}},{key:"setUserName",value:function(e){$(this.mainDiv).find("#firstName").html(e.substring(0,e.indexOf(" ")))}},{key:"setProfPic",value:function(e){$(this.mainDiv).find("#userProfPic").attr("src",e)}},{key:"setCoursesHyperLink",value:function(e){$(this.mainDiv).find("#course_button").on("click",function(){var t="#/courses/"+e;null==e&&(t="#/courses"),window.location.hash=t})}},{key:"setHomeHyperLink",value:function(){var e="#/courses";$(this.mainDiv).find("#home_button").on("click",function(){window.location.hash=e}.bind(this)),$(this.mainDiv).find("#home_button2").on("click",function(){window.location.hash=e}.bind(this))}},{key:"initAutocomplete",value:function(e){document.getElementById("searchBar").addEventListener("change",function(){var e=document.getElementById("searchBar").value.toLowerCase();$.inArray(e,autokeys)==-1&&e.length>2&&autokeys.push(e),localStorage.setItem("autokeys",autokeys)}),null!=e&&callAPI(login_origins.backend+"/getKeywordSuggestions","GET",{count:100,minKeywordLength:3,CourseId:e},function(e){var t=localStorage.getItem("autokeys");null!==t&&(autokeys=t.split(",")),$.extend(autokeys,e),$("#searchBar").autocomplete({source:autokeys,minLength:1,open:function(){$("ul.ui-autocomplete").addClass("opened")},close:function(){$("ul.ui-autocomplete").removeClass("opened").css("display","block")}}).data("ui-autocomplete")._renderItem=function(e,t){return $("<li class='li-key'></li>").data("item.autocomplete",t).append("<span class='key'>"+t.label+"</span>").appendTo(e)}})}},{key:"initLogout",value:function(e){var t=this;$(".logout-container").hover(function(){$("#name-logout").fadeOut("fast",function(){$("#name-logout").text("Logout?").fadeIn("fast")}),$("#name-logout").css({cursor:"pointer"})},function(){$("#name-logout").fadeOut("fast",function(){$("#name-logout").text("Hey "+e.substring(0,e.indexOf(" "))+"!").fadeIn("fast")})}),$("#name-logout").click(function(){t.logout()})}},{key:"logout",value:function(){callAPI(login_origins.backend+"/logout","GET",{},function(e){window.location.hash="/"})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Notes=function(){function e(t,n,i){_classCallCheck(this,e),this.text=n,this.mainDiv=t,this.podcastid=i,this.getTime(),this.initListeners(),n||(n=""),n.length>0&&this.mainDiv.find(".notes-content").text(n)}return _createClass(e,[{key:"getTime",value:function(){var e=new Date;this.month=e.getMonth(),this.day=e.getDate(),this.hour=e.getHours(),this.min=e.getMinutes(),this.hour<12?this.ap="AM":(this.ap="PM",this.hour-=12),0==this.hour&&(this.hour=12),this.month=this.checkTime(this.month),this.day=this.checkTime(this.day)}},{key:"checkTime",value:function(e){return e<10&&(e="0"+e),e}},{key:"initListeners",value:function(){this.mainDiv.find(".notes-content").keydown(function(e){9==e.keyCode&&(document.execCommand("insertHTML",!1,"&#009"),e.preventDefault())}.bind(this)),this.mainDiv.find(".save").click(function(){var e=$(".notes-content")[0].innerText;if(e||(e=$(".notes-content").html().trim().replace(/<br\s*\/*>/gi,"\n").replace(/(<(p|div))/gi,"\n$1").replace(/(<([^>]+)>)/gi,"")),e!=this.text){var t={PodcastId:this.podcastid,Content:e};callAPI(login_origins.backend+"/createNotes","POST",t,function(t){this.text=e,this.getTime(),$(".comment").html("Last updated on "+this.month+"/"+this.day+" at "+this.hour+":"+this.min+" "+this.ap)}.bind(this))}}.bind(this))}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Onboarding=function(){function e(t){_classCallCheck(this,e),console.log(t);var n,i=window.location.search.substring(1);if(i)n=this.getQueries(i);else{var o=window.location.href.indexOf("?");o>0&&(i=window.location.href.substring(o+1),n=this.getQueries(i))}$(t).find(".fb-login-button").on("click",function(){var e=window.location.origin+window.location.pathname,t=encodeURIComponent(e+"#/courses"),n=encodeURIComponent(e+"#");window.location.href=login_origins.backend+"/auth/facebook?callbackURL="+t+"&errorCallbackURL="+n}),n&&n.hasOwnProperty("redirectURL")?callAPI(login_origins.backend+"/isUserLoggedIn","GET",{},function(e){if(e.result)window.location.href=decodeURIComponent(n.redirectURL);else{var t=window.location.origin+window.location.pathname,i=encodeURIComponent(t+"#/?redirectURL="+n.redirectURL),o=encodeURIComponent(t+"#");window.location.href=login_origins.backend+"/auth/facebook?callbackURL="+i+"&errorCallbackURL="+o}}):callAPI(login_origins.backend+"/isUserLoggedIn","GET",{},function(e){e.result===!0?window.location.hash="/courses":callAPI(login_origins.backend+"/getUserSession","GET",{},function(e){e.user&&callAPI(login_origins.backend+"/setUserFromSession","GET",{},function(e){window.location.hash="/courses"})})})}return _createClass(e,[{key:"getQueries",value:function(e){var t=e.split("&").map(function(e){var t=e.split("="),n=t[0],i=t[1],o={};return o[n]=i,o}).reduce(function(e,t){var n=Object.keys(t)[0];return e[n]=t[n],e},{});return t}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),OnboardingCourses=function(){function e(t){_classCallCheck(this,e),this.tableRef=document.getElementById("myTable").getElementsByTagName("tbody")[0],this.fetchCourses()}return _createClass(e,[{key:"fetchCourses",value:function(){var e=login_origins.backend+"/getCourses";callAPI(e,"GET",{},function(e){this.loadCourses(e)}.bind(this))}},{key:"loadCourses",value:function(e){for(var t=0;t<e.length;t++){var n=this.tableRef.insertRow(this.tableRef.rows.length),i=n.insertCell(0),o=n.insertCell(1),s=n.insertCell(2);i.className="cell cell-end",o.className="cell cell-mid",s.className="cell cell-end",n.className="table-row",n.id=e[t].Id,n.addEventListener("click",function(){var e=window.location.origin+window.location.pathname,t=e+"#/courses/"+this.id;window.location.href=t,window.location.hash="/courses/"+this.id});var a=document.createTextNode(e[t].Course),r=e[t].Quarter;r.indexOf("fa")>-1&&(r="Fall "+r.slice(-2)),r.indexOf("wi")>-1&&(r="Winter "+r.slice(-2)),r.indexOf("sp")>-1&&(r="Spring "+r.slice(-2)),r.indexOf("s2")>-1&&(r="SS2 "+r.slice(-2)),r.indexOf("s1")>-1&&(r="SS1 "+r.slice(-2));var l=document.createTextNode(r),d=document.createElement("i");d.setAttribute("aria-hidden","true"),d.className="fa fa-graduation-cap sym",i.appendChild(a),o.appendChild(d),s.appendChild(l)}}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),PodcastPage=function(){function e(t,n,i,o){_classCallCheck(this,e),this.mainDiv=n,this.podcastID=t,this.startingSlide=i,this.loadingCallback=o,this.startingSlide||(this.startingSlide=1),this.fetchUserData(this),this.loadNavbar(this),this.loadRecommendations(n)}return _createClass(e,[{key:"fetchUserData",value:function(e){callAPI(login_origins.backend+"/getUser","GET",{},function(t){e.UserName=t.Name,e.UserPic=t.Pic,e.fetchVideo(e)})}},{key:"parseSlides",value:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].StartTime/1e3);this.slideTimes=t}},{key:"getTimeForSlide",value:function(e){return e<=0?(console.error("Remember that slide numbers start at 1, not 0"),0):(e-=1,e>=this.slideTimes.length?0:this.slideTimes[e])}},{key:"getSlideForTime",value:function(e){var t=this.getSlideForTimeHelper(this.slideTimes,function(t){return t-e});return t+1}},{key:"getSlideForTimeHelper",value:function(e,t){for(var n=0,i=e.length-1;n<=i;){var o=n+(i-n>>1),s=t(e[o]);if(s<0)n=o+1;else{if(!(s>0))return o;i=o-1}}return n-1}},{key:"getSlideClicks",value:function(){$(this.mainDiv).on("click",".slide-no",function(e){var t=(e.currentTarget,$(e.currentTarget).attr("data-slide")),n=$(e.currentTarget).attr("data-time");n?this.videoClass.setTime(n):this.videoClass.setTime(this.getTimeForSlide(t)),this.postSearch.updateCurrentVideoSlide(t),this.postSearch.changeSlideCompletely(t)}.bind(this))}},{key:"fetchVideo",value:function(e){callAPI(login_origins.backend+"/getVideoInfo","GET",{PodcastId:this.podcastID},function(t){e.audioData={ParsedAudioTranscriptForSearch:t.ParsedAudioTranscriptForSearch,Slides:t.Slides,PodcastID:e.podcastID},callAPI(login_origins.backend+"/getNotesForUser","GET",{PodcastId:e.podcastID},function(n){e.audioData.Notes=n.Notes,e.parseSlides(t.Slides),e.loadPosts(e,function(){e.loadVideo(e,t.VideoURL,0,t.SRTFile)})})})}},{key:"dynamicWindowResize",value:function(e){$(window).on("resize",function(){0==$(e.mainDiv).length?$("#myimage").off("click.mynamespace"):e.updatePostHeights()}),$(e.mainDiv).bind("DOMSubtreeModified",function(){e.updatePostHeights()})}},{key:"loadNavbar",value:function(e){require(["navbar"],function(){var t=$(e.mainDiv).find("#navbox");loadComponent("MenuModule",t,function(){new NavBarLoggedInCourse(t,e.podcastID)})})}},{key:"loadPosts",value:function(e,t){require(["postSearch"],function(){var n=$(e.mainDiv).find("#podcast-posts");loadComponent("PostSearchModule",n,function(){e.postSearch=new PostSearch({UniqueID:e.podcastID,TypeOfFetch:"PodcastSearch"},{Name:e.UserName,Pic:e.UserPic},n,e.audioData,{CurrentSlideNum:e.startingSlide},e.podcastID,function(){setTimeout(function(){e.updatePostHeights()},500),t()}.bind(e)),e.dynamicWindowResize(e)})})}},{key:"loadVideo",value:function(e,t,n,i){require(["video-wrapper"],function(){var n=$(e.mainDiv).find("#video-space");loadComponent("VideoModule",n,function(){e.videoClass=new videoClass(t,0,n,i,e.slideTimes,function(){e.getSlideClicks(),e.videoClass.setTime(e.getTimeForSlide(e.startingSlide)),e.updateSlideNumberFromVideo(),e.loadingCallback()})})})}},{key:"loadRecommendations",value:function(e){var t=this;require(["recommendations"],function(){var n=$(e).find("#recommendations-container");loadComponent("RecommendationsModule",n,function(){new Recommendations(e,t.podcastID)})})}},{key:"nextPreVideoListeners",value:function(){}},{key:"updateSlideNumberFromVideo",value:function(){$(this.mainDiv).find("#video-space").on("slideChange",function(e,t){this.postSearch.updateCurrentVideoSlide(t)}.bind(this))}},{key:"updatePostHeights",value:function(){var e=$(window).height()-$(this.mainDiv).find("#navbox").height();$(this.mainDiv).find("#podcast-posts").css("height",e)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),BoyMor=function(){function e(t){_classCallCheck(this,e),this.needle=t,this.charTable=this.makeCharTable(t),this.offsetTable=this.makeOffsetTable(t)}return _createClass(e,[{key:"bmIndexOf",value:function(e){var t=this.needle;if(0==t.length)return 0;for(var n,i=t.length-1;i<e.length;){for(n=t.length-1;t.charAt(n)==e.charAt(i);--i,--n)if(0==n)return i;i+=Math.max(this.offsetTable[t.length-1-n],this.charTable[e.charAt(i)])}return-1}},{key:"makeCharTable",value:function(e){for(var t=[],n=65535,i=0;i<n;++i)t.push(e.length);for(var i=0;i<e.length-1;++i)t[e.charAt(i)]=e.length-1-i;return t}},{key:"makeOffsetTable",value:function(e){for(var t=[],n=e.length,i=0;i<n;i++)t.push(0);for(var o=e.length,i=e.length-1;i>=0;--i)this.isPrefix(e,i+1)&&(o=i+1),t[e.length-1-i]=o-i+e.length-1;for(var i=0;i<e.length-1;++i){var s=this.suffixLength(e,i);t[s]=e.length-1-i+s}return t}},{key:"isPrefix",value:function(e,t){for(var n=t,i=0;n<e.length;++n,++i)if(e.charAt(n)!=e.charAt(i))return!1;return!0}},{key:"suffixLength",value:function(e,t){for(var n=0,i=t,o=e.length-1;i>=0&&e.charAt(i)==e.charAt(o);--i,--o)n+=1;return n}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),PodcastDropdownMenu=function(){function e(t,n){_classCallCheck(this,e),this.mainDiv=n,this.numSlides=t,this.dropdownMenuOptions=$(this.mainDiv).find(".dropdown-menu"),this.slideDropdownItems={},this.generateNonSlideOptions(),this.generateDropdownForSlides(),this.updateSlideTextListener(),$(this.mainDiv).find("#dropdownSlideSelection").children("span").html("Entire Lecture")}return _createClass(e,[{key:"generateNonSlideOptions",value:function(){for(var e=["Entire Lecture","Unresolved Posts","My Notes"],t=0;t<e.length;t++){var n=this.generateDropdownWithType(e[t]);this.slideDropdownItems[n[t]]=n,this.dropdownMenuOptions.append(n)}}},{key:"generateDropdownForSlides",value:function(){for(var e=1;e<=this.numSlides;e++){var t=this.generateOneDropdownForSlide(e);this.slideDropdownItems[e]=t,this.dropdownMenuOptions.append(t)}}},{key:"updateSlideTextListener",value:function(){$(this.mainDiv).find(".dropdown-item").on("click",function(e){"Entire Lecture"==$(e.target).html()&&$(this.mainDiv).trigger("AllLecture",[]),"Unresolved Posts"==$(e.target).html()&&$(this.mainDiv).trigger("UnresolvedLecture",[]),"My Notes"==$(e.target).html()&&$(this.mainDiv).trigger("ShowNotes",[]),$(this.mainDiv).find("#dropdownSlideSelection").children("span").html($(e.target).html())}.bind(this))}},{key:"switchToSlide",value:function(e){$(this.mainDiv).find("#dropdownSlideSelection").children("span").html($(this.slideDropdownItems[e]).html())}},{key:"switchToAllLecture",value:function(){$(this.mainDiv).find("#dropdownSlideSelection").children("span").html("Entire Lecture")}},{key:"generateDropdownWithType",value:function(e){return $("<a>").addClass("dropdown-item").attr("data-type",e).html(e)}},{key:"generateOneDropdownForSlide",value:function(e){return $("<a>").addClass("dropdown-item").addClass("slide-no").attr("data-slide",e).html("Slide "+e+" Feed")}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),OCRAudioPosts=function(){function e(t,n,i){_classCallCheck(this,e),this.audioPosts=[],this.ocrPosts=[],this.ocrAudioData=t,this.mainDiv=n,this.parseSlides(),this.generatePosts(this,function(){i()})}return _createClass(e,[{key:"doSearchInAudio",value:function(e){if(0==e.trim().length)return this.hideTable(this.audioPost),!0;for(var t=!1,n=0;n<this.audioPosts.length;n++){var i=this.audioPosts[n].checkForContent(e);t=t||i}return t?(this.showTable(this.audioPost),!0):(this.hideTable(this.audioPost),!1)}},{key:"doSearchInOCR",value:function(e){if(0==e.trim().length)return this.hideTable(this.ocrPost),!0;for(var t=!1,n=0;n<this.ocrPosts.length;n++){var i=this.ocrPosts[n].checkForContent(e);t=t||i}return t?(this.showTable(this.ocrPost),!0):(this.hideTable(this.ocrPost),!1)}},{key:"doSlideCheckInAudio",value:function(e){}},{key:"doSlideCheckInOCR",value:function(e){}},{key:"showTable",value:function(e){$(e).show()}},{key:"hideTable",value:function(e){$(e).hide()}},{key:"generatePosts",value:function(e,t){e.generatePostForAudio(e,function(){e.generatePostForOCR(e,function(){t()})})}},{key:"generatePostForAudio",value:function(e,t){loadHTMLComponent("AudioOCRMod",function(n){var i=$(n);$(i).find(".type-of-ocr").html("Audio Transcription Search");var o=$(e.mainDiv).find(".no-results");$(i).insertAfter(o),e.audioPost=i,e.generateIndividualPostsForAudio(i,e),e.hideTable(i),t()})}},{key:"generateIndividualPostsForAudio",value:function(e,t){for(var n=t.ocrAudioData.ParsedAudioTranscriptForSearch,i=0;i<n.length;i++)t.audioPosts.push(new OCRAudioIndPost(n[i].Content,t.getSlideForTime(n[i].StartTime),e,n[i].StartTime))}},{key:"generatePostForOCR",value:function(e,t){loadHTMLComponent("AudioOCRMod",function(n){var i=$(n);$(i).find(".type-of-ocr").html("Slide Search");var o=$(e.mainDiv).find(".no-results");$(i).insertAfter(o),e.ocrPost=i,e.generateIndividualPostsForOCR(i,e),e.hideTable(i),t()})}},{key:"generateIndividualPostsForOCR",value:function(e,t){for(var n=t.ocrAudioData.Slides,i=0;i<n.length;i++)t.ocrPosts.push(new OCRAudioIndPost(n[i].OCRTranscription,n[i].SlideNum,e,null))}},{key:"parseSlides",value:function(){for(var e=this.ocrAudioData.Slides,t=[],n=0;n<e.length;n++)t.push(e[n].StartTime/1e3);this.slideTimes=t}},{key:"getTimeForSlide",value:function(e){return e<=0?(console.error("Remember that slide numbers start at 1, not 0"),0):(e-=1,e>=this.slideTimes.length?0:this.slideTimes[e])}},{key:"getSlideForTime",value:function(e){var t=this.getSlideForTimeHelper(this.slideTimes,function(t){return t-e});return t+1}},{key:"getSlideForTimeHelper",value:function(e,t){for(var n=0,i=e.length-1;n<=i;){var o=n+(i-n>>1),s=t(e[o]);if(s<0)n=o+1;else{if(!(s>0))return o;i=o-1}}return n-1}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),
Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),APost=function(){function e(t,n,i,o){_classCallCheck(this,e),this.postData=t,this.userData=n,this.mainDiv=$(i),this.commentDiv=$(this.mainDiv).find(".comments"),this.commentForm=$(this.mainDiv).find(".comment-form"),this.numOfComments=this.postData.Comments.length,this.loadHeader(this.postData.Name,this.postData.ProfilePic),this.loadMainContent(this.postData.Content,this.postData.TimeOfPost,this.postData.SlideOfPost),this.loadCommentContent(this,this.postData.Comments),this.postID=this.postData.PostId,o?this.addCommentListener(this):$(this.commentForm).hide(),this.postData&&this.postData.LectureDate&&this.generateClickableLecturePost(this.postData.LectureDate)}return _createClass(e,[{key:"generateClickableLecturePost",value:function(e){var t=$(this.mainDiv).find(".slide-no");$(t).html($(t).html()+" - "+moment(e).format("MMM Do")).attr("data-podcast",this.postData.PodcastId)}},{key:"addCommentListener",value:function(e){$(this.commentForm).on("submit",function(t){t.preventDefault(),e.addComment($(e.mainDiv).find(".comment-answer"),e.userData.Pic,e.userData.Name,(new Date).getTime())})}},{key:"getNumComments",value:function(){return this.numOfComments}},{key:"addComment",value:function(e,t,n,i){var o={Content:$(e).val(),Time:i,PostId:this.postID};callAPI(login_origins.backend+"/createComment","POST",o,function(){this.loadIndividualComment({Pic:t,PosterName:n,Content:$(e).val(),Time:i}),this.numOfComments++,$(this.mainDiv).trigger("commentAdded",[]),$(e).val("")}.bind(this))}},{key:"searchForContent",value:function(e){var t=$(this.mainDiv).is(':contains("'+e+'")');return t?(this.showThisPost(),!0):(this.hideThisPost(),!1)}},{key:"fetchBySlide",value:function(e){var t=$($(this.mainDiv).find(".slide-no")).is(':contains("Slide '+e+'")');return t?(this.showThisPost(),!0):(this.hideThisPost(),!1)}},{key:"hideThisPost",value:function(){$(this.mainDiv).hide()}},{key:"showThisPost",value:function(){$(this.mainDiv).show()}},{key:"loadHeader",value:function(e,t){$(this.mainDiv).find(".profile-pic-post").attr("src",t),$(this.mainDiv).find(".name-of-poster").find("span").html(e)}},{key:"loadMainContent",value:function(e,t,n){var i=moment(new Date(t),"YYYYMMDD").fromNow();$(this.mainDiv).find(".time-sig-nat-lang").html(i),this.slideNo=n,$(this.mainDiv).find(".slide-no").html("Slide "+n).attr("data-slide",n),$(this.mainDiv).find(".post-main-content").find("span").html(e)}},{key:"loadCommentContent",value:function(e,t){loadHTMLComponent("CommentModule",function(n){e.commentModule=n;for(var i=0;i<t.length;i++)e.loadIndividualComment(t[i])})}},{key:"loadIndividualComment",value:function(e){var t=$(this.commentModule);$(t).find(".comment-pic-holder").attr("src",e.Pic),$(t).find(".comment-poster-name").html(e.PosterName),$(t).find(".comment-post-content").html(e.Content),$(t).find(".comment-time").html(moment(new Date(e.Time),"YYYYMMDD").fromNow()),$(this.commentDiv).append(t)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),PostSearch=function(){function e(t,n,i,o,s,a,r){_classCallCheck(this,e),this.currWord=0,this.postFetchData=t,this.userData=n,this.mainDiv=$(i).find(".search-module"),this.doneLoading=r,this.podcastid=a,this.slideTransitionDiv=$(this.mainDiv).parent().find(".rectangle").hide(),$(this.slideTransitionDiv).hide(),this.posts=[],this.currentViewData={PageType:"Lecture"},null!=s&&null!=s.CurrentSlideNum&&(this.videoCurrentSlide=s.CurrentSlideNum,this.currentViewData.SlideNo=this.videoCurrentSlide),this.setUpSlideTransitionModule(),this.searchModule=$(this.mainDiv).parent().find(".search-module"),this.noResultsOption=$(this.mainDiv).find(".no-results"),this.searchInputForm=$(this.mainDiv).prev(),this.searchInputField=$(this.searchInputForm).find("#secondary-search-bar"),this.viewAllPostsButton=$(this.mainDiv).find(".all-posts-view"),this.newPostButton=$(this.mainDiv).prev().find(".new-post-img"),this.loadingModule=$(this.mainDiv).parent().find("#slide-transition-data"),this.notesWrapper=$(this.mainDiv).find(".notes-module"),this.loadingModule.hide(),this.mark=new Mark($(this.searchModule)[0]),$(this.noResultsOption).hide(),o?(this.ocrModule=new OCRAudioPosts(o,this.mainDiv,function(){this.OCRAudioLoaded=!0}.bind(this)),this.numberOfSlides=o.Slides.length,loadHTMLComponent("NotesModule",function(e){var t=$(this.mainDiv).find(".notes-module").html(e);this.notesModule=$(t).find(".notes-wrapper"),this.notes=new Notes($(this.notesModule),o.Notes,this.podcastid),this.showNotes()}.bind(this))):$(this.mainDiv).on("click",".post-container",function(e){var t=e.currentTarget,n=$(t).find(".slide-no"),i=$(n).attr("data-podcast"),o=$(n).attr("data-slide");window.location.hash="#/podcast/"+i+"/"+o}),this.detectTypeOfPostsToShow(),this.loadPostsFromServer(this),this.noPostsNewPostHandling(this),this.startFormListeners(this),this.generateDropdownMenu(),this.handleAllLectureTrigger(),this.handleUnresolvedLectureTrigger()}return _createClass(e,[{key:"getCurrentSlideOfNewPost",value:function(){return"Slide"!=this.currentViewData.PageType?this.videoCurrentSlide:this.currentViewData.SlideNo}},{key:"noPostsNewPostHandling",value:function(e){$(this.viewAllPostsButton).on("click",function(t){t.preventDefault(),e.showAllPostsOfLecture()}),$(this.newPostButton).on("click",function(e){var t=$(this.searchInputField).val();0==t.trim().length?swal('Type your question in the "Search or write a post" search bar, and then press the post button!'):this.generateNewPost(t,(new Date).getTime(),this.getCurrentSlideOfNewPost())}.bind(this))}},{key:"changeSlideCompletely",value:function(e){e!=this.videoCurrentSlide?this.showNotifcationToUserForSlideTransition(this.videoCurrentSlide):this.slideTransitionDiv.hide(),this.currentViewData={PageType:"Slide",SlideNo:e},this.dropdownMenu.switchToSlide(e),this.cleanUpSearch(),this.searchForSlide(e)}},{key:"handleAllLectureTrigger",value:function(){$(this.mainDiv).parent().find(".dropdownOfSlide").on("AllLecture",function(){this.showAllPostsOfLecture()}.bind(this))}},{key:"handleUnresolvedLectureTrigger",value:function(){$(this.mainDiv).parent().find(".dropdownOfSlide").on("UnresolvedLecture",function(){this.showAllPostsUnresolved()}.bind(this))}},{key:"showAllPostsUnresolved",value:function(){this.currentViewData={PageType:"Unanswered"},this.updateCurrentVideoSlide(),this.cleanUpSearch(),this.findUnresolved()}},{key:"showAllPostsOfLecture",value:function(){this.currentViewData={PageType:"Lecture"},$(this.searchInputField).val(""),this.dropdownMenu.switchToAllLecture(),this.searchByText(""),this.updateCurrentVideoSlide()}},{key:"cleanUpSearch",value:function(){this.currWord=0,this.notesWrapper.hide(),$(this.searchInputField).val(""),this.searchNoText(),this.mark.unmark()}},{key:"updateCurrentVideoSlide",value:function(e){e&&(this.videoCurrentSlide=e),"Slide"!=this.currentViewData.PageType?this.showNotifcationToUserForSlideTransition(this.videoCurrentSlide):this.currentViewData.SlideNo!=this.videoCurrentSlide&&this.showNotifcationToUserForSlideTransition(this.videoCurrentSlide)}},{key:"showNotifcationToUserForSlideTransition",value:function(e){this.slideTransitionDiv.show(),this.slideTransitionDiv.find(".rectangle-notif-slide-data").html("Slide "+e).attr("data-slide",e)}},{key:"startFormListeners",value:function(e){return this.OCRAudioLoaded?(this.doneLoading&&this.doneLoading(),$(this.searchInputForm).on("submit",function(e){e.preventDefault(),$(this.searchInputField).val().length>1?(this.loadingModule.show(),this.searchByText($(this.searchInputField).val())):0==$(this.searchInputField).val().trim().length&&this.searchByText("")}.bind(this)),void $(this.searchInputField).on("input",function(e){var t=$(this.searchInputField).val();e.preventDefault(),t.length>1?(this.currWord=t,setTimeout(function(e){this.loadingModule.show(),e==this.currWord&&this.searchByText(e)}.bind(this,t),200)):0==t.trim().length&&this.searchByText("")}.bind(this))):void setTimeout(function(){this.startFormListeners(this)}.bind(this),500)}},{key:"detectTypeOfPostsToShow",value:function(){"PodcastSearch"!=this.postFetchData.TypeOfFetch?($(this.mainDiv).parent().find(".dropdownOfSlide").parent().hide(),$(this.mainDiv).parent().find(".dropdownOfSlide").css("padding",0).hide(),$(this.mainDiv).parent().find(".main_search_container_post").css("padding",0).hide(),$(this.mainDiv).parent().find(".search-module-main").css("padding-top",0),$(this.searchModule).css("border","none"),this.shouldAllowNewComments=!1):this.shouldAllowNewComments=!0}},{key:"generateNewPost",value:function(e,t,n){var i={PodcastId:this.podcastid,SlideOfPost:n,TimeOfPost:t,Content:e};callAPI(login_origins.backend+"/createPost","POST",i,function(i){var o={Name:this.userData.Name,PostId:i,ProfilePic:this.userData.Pic,Content:e,TimeOfPost:t,SlideOfPost:n,Comments:[]};$(this.searchInputField).val(""),this.loadPost(this,o,!0),this.showAllPostsOfLecture()}.bind(this))}},{key:"showNotes",value:function(){this.currentViewData={PageType:"Notes"},$(this.mainDiv).parent().find(".dropdownOfSlide").on("ShowNotes",function(){this.changeSlideCompletely(),this.cleanUpSearch(),this.notesWrapper.show(),$(this.noResultsOption).hide()}.bind(this))}},{key:"searchForSlide",value:function(e){var t=!1;$(this.noResultsOption).hide();for(var n=0;n<this.posts.length;n++)t=this.posts[n].fetchBySlide(e)||t;t||$(this.noResultsOption).is(":visible")||$(this.noResultsOption).fadeIn()}},{key:"findUnresolved",value:function(){var e=!1;$(this.noResultsOption).hide();for(var t=0;t<this.posts.length;t++)0==this.posts[t].getNumComments()?(this.posts[t].showThisPost(),e=!0):this.posts[t].hideThisPost();e||$(this.noResultsOption).is(":visible")||$(this.noResultsOption).fadeIn()}},{key:"setUpSlideTransitionModule",value:function(){loadHTMLComponent("SlideTransitionModule",function(e){$(this.mainDiv).parent().find("#slide-transition-data").html(e)}.bind(this))}},{key:"searchNoText",value:function(){this.mark.unmark(),this.currentTextBeingSearched=0;for(var e=0;e<this.posts.length;e++)this.posts[e].hideThisPost();this.ocrModule.doSearchInAudio(""),this.ocrModule.doSearchInOCR("")}},{key:"searchByText",value:function(e){this.mark.unmark(),this.notesWrapper.hide();new BoyMor(e.toUpperCase());this.currentTextBeingSearched=e;for(var t=!1,n=0;n<this.posts.length;n++){var i=this.posts[n].searchForContent(e);t=t||i}var o=this.ocrModule.doSearchInAudio(e),s=this.ocrModule.doSearchInOCR(e);t=t||o||s,t?(this.mark.mark(e,{caseSensitive:!1,separateWordSearch:!1,exclude:[".pre-slide-data",".slide-no"]}),$(this.noResultsOption).hide()):$(this.noResultsOption).is(":visible")||$(this.noResultsOption).fadeIn(),setTimeout(function(){this.loadingModule.hide()}.bind(this),500)}},{key:"remarkText",value:function(){null!=this.currentTextBeingSearched&&0!=this.currentTextBeingSearched&&(this.mark.unmark(),this.mark.mark(this.currentTextBeingSearched,{caseSensitive:!1,separateWordSearch:!1,exclude:[".pre-slide-data",".slide-no"]}))}},{key:"generateDropdownMenu",value:function(){"PodcastSearch"==this.postFetchData.TypeOfFetch&&(this.dropdownMenu=new PodcastDropdownMenu(this.numberOfSlides,$(this.mainDiv).parent().find(".dropdownOfSlide")))}},{key:"loadPostsFromServer",value:function(e){var t=this.postFetchData,n=login_origins.backend+"/getPostsForLecture",i={PodcastId:t.UniqueID};"CourseGlobal"==t.TypeOfFetch?(n=login_origins.backend+"/getPostsForCourse",i={CourseId:t.UniqueID}):"CourseSearch"==t.TypeOfFetch&&(n=login_origins.backend+"/getPostsByKeyword",i={CourseId:t.UniqueID,Keywords:t.SearchQuery}),callAPI(n,"GET",i,function(t){for(var n=0;n<t.length;n++)e.loadPost(e,t[n])})}},{key:"loadPostModuleData",value:function(e){loadHTMLComponent("PostModule",function(t){e(t)})}},{key:"loadPost",value:function(e,t,n){e.loadPostModuleData(function(i){var o=$(i),s=new APost(t,e.userData,o,e.shouldAllowNewComments);e.posts.push(s),n?$(e.mainDiv).prepend(o):$(e.mainDiv).append(o),$(o).on("commentAdded",function(){e.remarkText()})})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),OCRAudioIndPost=function(){function e(t,n,i,o){_classCallCheck(this,e),this.divToAppend=i,this.content=t.replace(/\n\s*\n/g,"\n"),this.slideNum=n,this.startTime=o,this.loadComponentAndAddData(this,function(){})}return _createClass(e,[{key:"loadComponentAndAddData",value:function(e,t){loadHTMLComponent("AudioOCRSubMod",function(n){e.entireData=$(n),$($(e.entireData)[2]).find("span").html(e.content),e.determineSlideData($(e.entireData).find(".pre-slide-data"),$(e.entireData).find(".slide-no")),$(e.divToAppend).append(e.entireData),e.hideThisPost(e),t()})}},{key:"ensureDataLoad",value:function(e){null!=this.entireData?e():this.loadComponentAndAddData(this,function(){e()})}},{key:"showThisPost",value:function(e){setTimeout(function(){e.ensureDataLoad(function(){$(e.entireData).show()})},0)}},{key:"hideThisPost",value:function(e){setTimeout(function(){e.ensureDataLoad(function(){$(e.entireData).hide()})},0)}},{key:"checkForContent",value:function(e){var t=this.content.toUpperCase().indexOf(e.toUpperCase())>=0;return t?(this.showThisPost(this),!0):(this.hideThisPost(this),!1)}},{key:"determineSlideData",value:function(e,t){$(t).attr("data-slide",this.slideNum).html("Slide "+this.slideNum),this.startTime?($(e).html("At "+this.getMinutesSecondsString()),$(t).attr("data-time",this.startTime)):$(e).html("Found on ")}},{key:"getMinutesSecondsString",value:function(){return null==this.startTime?"":parseInt(this.startTime/60)+" minutes and "+parseInt(this.startTime%60)+" seconds on "}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Recommendations=function(){function e(t,n){_classCallCheck(this,e),this.podcastid=n,this.getRecommendations(function(e,n){this.displayRecomm($(t).find(".podcast-recommendations"),e),$(t).find(".lecture-date").html(new Date(n).toDateString())}.bind(this))}return _createClass(e,[{key:"displayRecomm",value:function(e,t){var n=0,i=!0,o=!1,s=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var l=a.value;if(n++,5==n)return;var d=l.PodcastId,c=l.PodcastImage,u=l.Time,h=document.createElement("a");h.href=window.location.hash.substring(0,window.location.hash.lastIndexOf("/")+1)+d;var m=document.createElement("div");$(m).addClass("rec-container pure-u-6-24");var f=document.createElement("img");f.src=c,$(f).addClass("rec-preview-img");var p=document.createElement("div");p.textContent=new Date(u).toDateString(),$(p).addClass("rec-title"),$(m).append(f),$(m).append(p),$(h).append(m),$(e).append(h)}}catch(e){o=!0,s=e}finally{try{!i&&r.return&&r.return()}finally{if(o)throw s}}}},{key:"getRecommendations",value:function(e){callAPI(login_origins.backend+"/getRecommendations","GET",{PodcastId:this.podcastid},function(t){e(t.Recommendations,t.Time)})}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),SearchVideosClass=function(){function e(t,n,i){_classCallCheck(this,e),this.courseId=t,this.mainDiv=n;var o=$(this.mainDiv).find("#search-videos-div")[0];$(this.mainDiv).find("#title").html('Here are some videos we found about "'+i+'"'),this.keywordLoadFromCrud(i,t,o),callAPI(login_origins.backend+"/searchByKeywords","GET",{count:6,CourseId:this.courseId,Keywords:i},function(e){console.log(e);var t=$(this.mainDiv).find(".videos-div")[0];o.appendChild(t),t.class="scroll";var n=document.createElement("div");n.className="row videos-row",t.appendChild(n);for(var i=e,s=0;s<i.length;s++){var a=i[s];3==n.childElementCount&&(n=document.createElement("div"),n.className="row videos-row",t.appendChild(n));var r=document.createElement("div");r.className="col-4",n.appendChild(r);var l=document.createElement("img");l.className="search-videos-img",l.src=i[s].PodcastImage,l.addEventListener("click",function(){window.location.hash="#/podcast/"+a.PodcastId}.bind(a)),r.appendChild(l);var d=document.createElement("p");d.className="textUnderVid",d.innerHTML=moment(i[s].Time).format("ddd, MMM Do"),r.appendChild(d)}}.bind(this))}return _createClass(e,[{key:"keywordLoadFromCrud",value:function(e,t,n){callAPI(login_origins.backend+"/getKeywordSuggestions","GET",{count:50,minKeywordLength:3,CourseId:t},function(i){i.sort(function(){return.5-Math.random()}),this.keywordGeneration(e,t,n,i)}.bind(this))}},{key:"keywordGeneration",value:function(e,t,n,i){for(var o=$(".recClass")[0],s=0;s<6;s++){var a=document.createElement("button");a.innerHTML=i[s],o.appendChild(a);var r=this.fnGetRandomColour(120,250);$(a).css({border:"2pxsolid "+r,"background-color":r}),$(a).on("click",function(e){window.location.hash="#/search/"+t+"/"+$(e.target).html()})}}},{key:"fnGetRandomColour",value:function(e,t){for(var n=0;n<20;n++){var i=("ffffff"+Math.floor(16777215*Math.random()).toString(16)).substr(-6),o=parseInt(i,16),s=o>>16&255,a=o>>8&255,r=o>>0&255,l=.2126*s+.7152*a+.0722*r;if(l>e&&l<t)return i}return i}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),SearchPage=function(){function e(t,n,i){_classCallCheck(this,e),this.mainDiv=n,this.podcastID=t,this.searchTerm=i,this.loadNavbar(this),this.loadVideos(this),this.loadPosts(this)}return _createClass(e,[{key:"loadNavbar",value:function(e){require(["navbar"],function(){var t=$(e.mainDiv).find("#navbox");loadComponent("MenuModule",t,function(){var n=new NavBarLoggedInCourse(t,e.podcastID);n.setValueOfSearchBar(e.searchTerm)})})}},{key:"loadPosts",value:function(e){require(["postSearch"],function(){var t=$(e.mainDiv).find("#posts");loadComponent("PostSearchModule",t,function(){new PostSearch({UniqueID:e.podcastID,TypeOfFetch:"CourseSearch",SearchQuery:e.searchTerm},{Name:e.UserName,Pic:e.UserPic},t),e.dynamicWindowResize(e)})})}},{key:"loadVideos",value:function(e){require(["search-videos"],function(){var t=$(e.mainDiv).find("#search-videos");loadComponent("SearchResultsModule",t,function(){new SearchVideosClass(e.podcastID,$(e.mainDiv),e.searchTerm)})})}},{key:"dynamicWindowResize",value:function(e){$(window).on("resize",function(){0==$(e.mainDiv).length?$("#myimage").off("click.mynamespace"):e.updateComponentHeights()}),$(e.mainDiv).bind("DOMSubtreeModified",function(){e.updateComponentHeights()})}},{key:"updateComponentHeights",value:function(){var e=$(window).height()-$(this.mainDiv).find("#navbox").height();$(this.mainDiv).find("#posts").css("height",e-35),$(this.mainDiv).find("#search-videos").css("height",e-35)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),videoClass=function(){function e(t,n,i,o,s,a){_classCallCheck(this,e),this.mainDiv=i,this.slides=s,this.index=0;var r=this;this.initWithCaptions(o,function(){r.setSource(t),r.setTime(n),r.getTime(),r.initHotKeys(),r.initListeners(),a()})}return _createClass(e,[{key:"initListeners",value:function(){this.mainDiv.on("changeVideo",function(e,t){videojs("my-video").ready(function(){})}),this.timeUpdateListener(videojs("my-video"))}},{key:"setSource",value:function(e){videojs("my-video").src({type:"video/mp4",src:e}),this.source=e}},{key:"initHotKeys",value:function(){videojs("my-video").hotkeys({seekStep:5,enableModifiersForNumbers:!1,enableVolumeScroll:!1})}},{key:"setTime",value:function(e){videojs("my-video").currentTime(e)}},{key:"timeUpdateListener",value:function(e){var t=1;e.ready(function(){e.on("timeupdate",function(){var n=this.getSlideForTime(e.currentTime());n!=t&&($(this.mainDiv).trigger("slideChange",[n]),t=n)}.bind(this))}.bind(this))}},{key:"getSlideForTime",value:function(e){var t=this.getSlideForTimeHelper(this.slides,function(t){return t-e});return t+1}},{key:"getSlideForTimeHelper",value:function(e,t){for(var n=0,i=e.length-1;n<=i;){var o=n+(i-n>>1),s=t(e[o]);if(s<0)n=o+1;else{if(!(s>0))return o;i=o-1}}return n-1}},{key:"getTime",value:function(){this.mainDiv.on("getTime",function(e){videojs("my-video").ready(function(){var e=videojs("my-video"),t=e.currentTime(),n=Math.floor(t/60);Math.floor(t-60*n)}.bind(this))}.bind(this))}},{key:"initWithCaptions",value:function(e,t){var n=new File([e],"captionFile.srt"),i=URL.createObjectURL(n);videojs.getPlayers()["my-video"]&&delete videojs.getPlayers()["my-video"],videojs("my-video",{controls:!0,class:"video-js vjs-default-skin vjs-big-play-centered vjs-16-9",playbackRates:[1,1.25,1.5,1.75,2,2.25,2.5,2.75,3],autoplay:!0,tracks:[{src:i,kind:"captions",srclang:"en",label:"English"}]},t)}}]),e}();